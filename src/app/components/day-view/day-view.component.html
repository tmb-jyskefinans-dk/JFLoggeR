<div class="grid grid-cols-1 xl:grid-cols-[minmax(0,1fr)_320px] gap-6 items-start">
  <!-- Left column: Selected day entries -->
  <div class="rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-6 text-slate-700 dark:text-slate-200">
    <div class="flex items-center justify-between mb-2">
  <h2 class="text-lg font-semibold tracking-tight dark:text-slate-100">Dag: <span class="font-medium text-indigo-600 dark:text-indigo-300">{{ formattedDay() }}</span></h2>
  <a [routerLink]="['/summary', day()]" class="inline-flex items-center justify-center rounded-md text-sm font-semibold px-4 h-10 gap-2 bg-white text-slate-700 border border-slate-300 hover:bg-slate-100 active:bg-slate-200 dark:bg-slate-700 dark:text-slate-200 dark:border-slate-600 dark:hover:bg-slate-600" aria-label="Vis opsummering for {{formattedDay()}}">Se opsummering</a>
    </div>
    <div class="overflow-auto mt-4 max-h-[55vh]">
      <table class="min-w-full text-sm" aria-label="Entries for {{day()}}">
        <thead class="text-slate-600 dark:text-slate-300">
          <tr>
            <th scope="col" class="text-left py-2">Start</th>
            <th scope="col" class="text-left">Slut</th>
            <th scope="col" class="text-left">Beskrivelse</th>
            <th scope="col" class="text-left">Kategori</th>
            <th scope="col" class="text-left" aria-label="Handlinger"></th>
          </tr>
        </thead>
        <tbody class="divide-y">
          @for(r of rows(); track r.start) {
            @if(!r.missing) {
              <tr class="transition-colors hover:bg-indigo-50 dark:hover:bg-slate-700/60 hover:text-slate-900 dark:hover:text-slate-50">
                <td class="py-2 font-medium">{{r.start}}</td>
                <td>{{r.end}}</td>
                <td>{{r.description}}</td>
                <td class="relative">
                  @if(!isEditing(r)) {
                    <button type="button" (click)="beginEdit(r, $event)" class="group inline-flex items-center gap-2 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 rounded px-1"
                      [attr.aria-label]="'Redigér kategori for ' + r.start">
                      <span [style.background]="getColor(r.category)" class="inline-block w-3 h-3 rounded-sm align-middle"></span>
                      <span [style.color]="getColor(r.category)" class="font-semibold group-hover:underline">{{r.category}}</span>
                    </button>
                  } @else {
                    <div data-cat-menu class="fixed z-50 w-60 rounded-md border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 shadow-lg py-1"
                      [style.left.px]="menuX()" [style.top.px]="menuY()" [class.animate-out-up]="menuFlip()" [class.animate-out-down]="!menuFlip()">
                      <div class="max-h-72 overflow-auto text-xs">
                        @for(group of menuCategoryGroups(); track group.label; let gi = $index; let last = $last) {
                          <div class="px-2 pt-1 pb-0.5 text-[10px] uppercase tracking-wide font-semibold text-slate-500 dark:text-slate-400">{{group.label}}</div>
                          @for(cat of group.items; track cat) {
                            <button type="button" (click)="applyCategory(r, cat)" class="flex w-full items-center gap-2 text-left px-2 py-1 rounded hover:bg-indigo-50 dark:hover:bg-slate-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500"
                              [attr.aria-label]="'Vælg kategori ' + cat">
                              <span [style.background]="getColor(cat)" class="inline-block shrink-0 w-4 h-4 rounded-sm"></span>
                              <span class="truncate flex-1">{{cat}}</span>
                            </button>
                          }
                          @if(!last) { <div class="my-1 h-px bg-slate-200 dark:bg-slate-600" aria-hidden="true"></div> }
                        }
                      </div>
                      <div class="flex justify-end mt-1 px-2 pb-1">
                        <button type="button" (click)="cancelEdit()" class="text-[10px] px-2 py-0.5 rounded border border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 hover:bg-slate-100 dark:hover:bg-slate-500">Luk</button>
                      </div>
                    </div>
                    <span [style.background]="getColor(r.category)" class="inline-block w-3 h-3 rounded-sm align-middle mr-2"></span>
                    <span [style.color]="getColor(r.category)" class="font-semibold">{{r.category}}</span>
                  }
                </td>
                <td>
                  <button type="button"
                          (click)="remove(r)"
                          class="text-slate-400 hover:text-red-600 dark:text-slate-500 dark:hover:text-red-400 rounded focus:outline-none focus:ring-2 focus:ring-red-500/40"
                          aria-label="Slet interval {{r.start}}">
                    <span aria-hidden="true">×</span>
                  </button>
                </td>
              </tr>
            } @else {
              <tr class="hover:bg-rose-50/70 dark:hover:bg-rose-900/30">
                <td class="py-2 font-medium text-rose-600 dark:text-rose-400">{{r.start}}</td>
                <td class="text-rose-600 dark:text-rose-400">{{r.end}}</td>
                <td colspan="2" class="italic font-semibold text-rose-700 dark:text-rose-300">
                  Mangler registrering
                  <span class="ml-2 inline-block w-2 h-2 rounded-full bg-rose-500 dark:bg-rose-400" aria-hidden="true"></span>
                </td>
                <td>
                  <button type="button"
                          (click)="logMissing(r.start)"
                          class="inline-flex items-center justify-center rounded-md text-xs font-semibold px-2 h-7 gap-1 bg-rose-600 text-white hover:bg-rose-500 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-500/60"
                          aria-label="Log manglende interval {{r.start}}">
                    Log
                  </button>
                </td>
              </tr>
            }
          }
        </tbody>
      </table>
      @if(!rows().length) {
        <p class="text-slate-500 dark:text-slate-400 text-sm mt-2" role="status" aria-live="polite">Ingen registreringer endnu.</p>
      }
    </div>
  </div>

  <!-- Right column: Archive days list -->
  <div class="rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-6 text-slate-700 dark:text-slate-200 xl:sticky xl:top-4">
    <h3 class="font-semibold mb-3 dark:text-slate-100 text-sm flex items-center gap-2">
      <svg class="w-4 h-4 text-slate-500 dark:text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v4"/><path d="M16 2v4"/><rect x="3" y="8" width="18" height="13" rx="2"/><path d="M3 10h18"/></svg>
  Andre dage
    </h3>
  <div class="overflow-auto max-h-[55vh] pr-1" aria-label="Andre registrerede dage">
      <ul class="text-sm space-y-1">
        @for(d of daysWithWeekday(); track d.day) {
          <li class="py-1 flex items-center justify-between gap-2">
            <div class="flex items-center gap-2">
      <button type="button"
          class="relative inline-flex items-center justify-center w-4 h-4 rounded-full focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400"
          (click)="toggleExportedDot(d.day)"
          [attr.aria-label]="d.exported ? (d.day + ' afstemt') : ('Afstem ' + d.day)"
          title="Afstem status">
        <!-- Small dot for visual (keeps larger focus target for accessibility) -->
        <span class="block w-2 h-2 rounded-full"
          [style.background]="d.exported ? 'var(--tw-color-emerald-600,#059669)' : 'var(--tw-color-slate-300,#cbd5e1)'"
          aria-hidden="true"></span>
        <span class="sr-only">{{ d.exported ? 'Afstemt' : 'Ikke afstemt' }}</span>
      </button>
              <a class="underline hover:text-indigo-600 dark:text-indigo-300 dark:hover:text-indigo-200" [routerLink]="['/day', d.day]" [attr.aria-label]="'Vis dag ' + d.day">
                <span class="text-indigo-600 dark:text-indigo-300 font-semibold">{{d.weekday}}</span> {{d.day}}
              </a>
            </div>
            <span class="text-xs text-slate-500 dark:text-slate-400" [attr.aria-label]="d.slots + ' intervaller'">{{d.slots}} intervaller</span>
          </li>
        }
      </ul>
      @if(!days().length) {
  <p class="text-slate-500 dark:text-slate-400 text-xs mt-2" role="status" aria-live="polite">Ingen andre dage registreret endnu.</p>
      }
    </div>
  </div>
</div>
