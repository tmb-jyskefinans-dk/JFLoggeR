<div class="rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-6 text-slate-700 dark:text-slate-200">
  <h2 class="text-lg font-semibold tracking-tight dark:text-slate-100 flex items-center gap-2">
  <span>Opsummering for</span>
    <span class="px-2 py-0.5 rounded-md bg-indigo-50 text-indigo-700 dark:bg-indigo-500/20 dark:text-indigo-200 text-sm font-medium" aria-label="Selected day">{{day()}}</span>
  </h2>
  <div class="overflow-auto mt-4">
      @if(rootGroupTotals().length) {
        <div class="mb-6">
          <h3 class="text-sm font-semibold tracking-tight text-slate-600 dark:text-slate-300 mb-3">Root kategorier</h3>
          <div class="space-y-4" aria-label="Root kategorier oversigt">
            @for(g of rootGroupTotals(); track g.label) {
              <section class="rounded-lg border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/30 p-4">
                <header class="flex items-center justify-between mb-2">
                  <h4 class="text-xs font-semibold uppercase tracking-wide text-slate-600 dark:text-slate-300">{{g.label}}</h4>
                  <span class="text-xs font-semibold text-indigo-600 dark:text-indigo-300">{{g.minutes}} min • {{g.slots}} intervaller</span>
                </header>
                <ul class="grid gap-2 sm:grid-cols-2 lg:grid-cols-3" aria-label="Underkategorier for {{g.label}}">
                  @for(child of g.children; track child.category) {
                    <li class="rounded-md border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800/40 p-3 flex flex-col gap-1">
                      <div class="flex items-center justify-between">
                        <span class="text-[11px] font-medium text-slate-700 dark:text-slate-200">{{child.category || 'Ingen kategori'}}</span>
                        <span class="text-[11px] text-indigo-600 dark:text-indigo-300 font-semibold">{{child.minutes}} min</span>
                      </div>
                      <div class="text-[10px] text-slate-500 dark:text-slate-400">{{child.slots}} intervaller</div>
                      <div class="h-1 rounded bg-slate-200 dark:bg-slate-600 overflow-hidden" aria-hidden="true">
                        <div class="h-full bg-indigo-500 dark:bg-indigo-400" [style.width.%]="(child.minutes/totalMinutes())*100"></div>
                      </div>
                    </li>
                  }
                </ul>
              </section>
            }
          </div>
        </div>
      }
      @if(categoryChartData().length) {
        <div class="mb-8">
          <h3 class="text-sm font-semibold tracking-tight text-slate-600 dark:text-slate-300 mb-3">Kategori fordeling (minutter)</h3>
          <!-- Horizontal bar chart -->
          <div class="space-y-2" role="group" aria-label="Horisontal søjlediagram over minutter pr. kategori">
            @for(c of categoryChartData(); track c.category) {
              <div class="flex items-center gap-2">
                <div class="w-32 truncate text-[11px] font-medium" [style.color]="c.color">{{c.category || 'Ingen'}}</div>
                <div class="flex-1 h-3 rounded bg-slate-200 dark:bg-slate-700 overflow-hidden" aria-hidden="true">
                  <div class="h-full" [style.background]="c.color" [style.width.%]="c.percent" title="{{c.minutes}} min ({{c.percent|number:'1.0-1'}}%)"></div>
                </div>
                <div class="w-20 text-right text-[11px] text-slate-600 dark:text-slate-300">{{c.minutes}} min</div>
              </div>
            }
          </div>
          <!-- Donut chart -->
          <div class="mt-6 flex flex-col lg:flex-row gap-6">
            <figure class="flex flex-col items-center gap-2" aria-label="Donutdiagram kategori minutter">
              <svg viewBox="0 0 140 140" width="180" height="180" role="img" aria-labelledby="donutTitle donutDesc">
                <title id="donutTitle">Kategori minutter</title>
                <desc id="donutDesc">Fordeling af loggede minutter per kategori for valgt dag</desc>
                <circle cx="70" cy="70" r="54" fill="none" stroke="var(--tw-color-slate-300,var(--tw-prose-body))" stroke-width="18" opacity="0.25"></circle>
                @for(seg of donutSegments(); track seg.category) {
      <circle cx="70" cy="70" r="54" fill="none" [attr.stroke]="seg.color" stroke-width="18" stroke-linecap="butt"
        [attr.stroke-dasharray]="seg.length + ' ' + (circumference - seg.length)"
                          [attr.stroke-dashoffset]="-seg.offset" opacity="0.95">
                    <title>{{seg.category || 'Ingen'}}: {{seg.minutes}} min ({{seg.percent|number:'1.0-1'}}%)</title>
                  </circle>
                }
              </svg>
              <figcaption class="text-xs text-slate-500 dark:text-slate-400">Total: {{totalMinutes()}} min</figcaption>
            </figure>
            <ul class="grid xs:grid-cols-2 gap-2 flex-1" aria-label="Kategori farve forklaring">
              @for(c of categoryChartData(); track c.category) {
                <li class="flex items-center gap-2 text-[11px]">
                  <span class="w-3 h-3 rounded-sm" [style.background]="c.color"></span>
                  <span class="flex-1 truncate">{{c.category || 'Ingen kategori'}}</span>
                  <span class="font-medium">{{c.minutes}} min</span>
                  <span class="text-slate-500 dark:text-slate-400">({{c.percent|number:'1.0-1'}}%)</span>
                </li>
              }
            </ul>
          </div>
        </div>
      }
    <table class="min-w-full text-sm" aria-describedby="summaryTotals" aria-label="Work slot summary table">
  <caption class="text-left text-sm text-slate-500 dark:text-slate-400 mb-2">Samlet oversigt over arbejdsslots for {{day()}}</caption>
      <thead class="text-slate-600 dark:text-slate-300">
        <tr>
          <th scope="col" class="text-left py-2">Beskrivelse</th>
          <th scope="col" class="text-left">Kategori</th>
          <th scope="col" class="text-left">Intervaller</th>
          <th scope="col" class="text-left">Minutter</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
        @if(loading()) {
          @for(i of [1,2,3,4]; track i) {
            <tr>
              <td class="py-2"><div class="h-4 w-40 rounded bg-slate-200 dark:bg-slate-700 animate-pulse" aria-hidden="true"></div><span class="sr-only">Indlæser beskrivelse…</span></td>
              <td><div class="h-4 w-24 rounded bg-slate-200 dark:bg-slate-700 animate-pulse" aria-hidden="true"></div><span class="sr-only">Indlæser kategori…</span></td>
              <td><div class="h-4 w-10 rounded bg-slate-200 dark:bg-slate-700 animate-pulse" aria-hidden="true"></div><span class="sr-only">Indlæser intervaller…</span></td>
              <td><div class="h-4 w-14 rounded bg-slate-200 dark:bg-slate-700 animate-pulse" aria-hidden="true"></div><span class="sr-only">Indlæser minutter…</span></td>
            </tr>
          }
        } @else {
          @for(s of rows(); track s.minutes) {
          <tr class="transition-colors hover:bg-indigo-50 dark:hover:bg-slate-700/60 hover:text-slate-900 dark:hover:text-slate-50">
            <th scope="row" class="py-2 font-medium text-left">{{s.description}}</th>
            <td>{{s.category}}</td>
            <td class="text-slate-600 dark:text-slate-300">{{s.slots}}</td>
            <td class="text-slate-600 dark:text-slate-300">{{s.minutes}}</td>
          </tr>
          }
        }
      </tbody>
      @if(rows().length) {
        <tfoot class="text-slate-700 dark:text-slate-200">
          <tr id="summaryTotals" class="border-t border-slate-300 dark:border-slate-600">
            <th scope="row" class="py-2 font-semibold text-left" colspan="2">Totaler</th>
            <td class="font-semibold">{{totalSlots()}}</td>
            <td class="font-semibold">{{totalMinutes()}}</td>
          </tr>
        </tfoot>
      }
    </table>
  </div>
  @if(!loading() && !rows().length) {
    <div class="mt-6 text-sm text-slate-500 dark:text-slate-400 flex items-center gap-2" role="status" aria-live="polite">
      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
  Ingen opsummeringsposter endnu for denne dag.
    </div>
  }
</div>
